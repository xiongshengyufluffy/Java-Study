

- 分析
  - 常见的线程不安全的集合类有ArrayList,HashMap,HashSet
    - 与之对应的线程安全的集合类有CopyOnWriteArrayList, ConcurrentHashMap, CopyOnWriteArraySet
  - 要造成线程不安全的情况,只需要创建多个线程,每个线程往集合中添加元素
  
- 代码
```
    public static void listNotSafe(){
        List<String> list = new ArrayList<>();
        for (int i = 0; i < 30; i++) {
            new Thread(() -> {
                list.add(Thread.currentThread().getName());
                System.out.println(Thread.currentThread().getName() + "\tadd " + "list is: " + list);
            }, String.valueOf(i)).start();
        }
    }
```
- 效果
  - ps:不一定每一次都会抛出ConcurrentModificationException,因为该异常在多线程环境下只是尽最大可能去抛出
```
0	add list is: [0, 1]
3	add list is: [0, 1, 2, 3]
2	add list is: [0, 1, 2]
1	add list is: [0, 1]
6	add list is: [0, 1, 2, 3, 4, 5, 6]
5	add list is: [0, 1, 2, 3, 4, 5]
4	add list is: [0, 1, 2, 3, 4]
8	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8]
7	add list is: [0, 1, 2, 3, 4, 5, 6, 7]
9	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
10	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
11	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
12	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
13	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13]
14	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
15	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
16	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
17	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
18	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18]
19	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
20	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
21	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21]
22	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22]
23	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]
24	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]
25	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25]
26	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26]
27	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
28	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28]
29	add list is: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29]
```
- 另外一种可能的输出结果
```
22	add list is: [0, 2, 4, 6, 3, 8, 7, 1, 9, 10, 5, 11, 12, 14, 15, 13, 16, 17, 18, 19, 20, 23, 21, 22]
27	add list is: [0, 2, 4, 6, 3, 8, 7, 1, 9, 10, 5, 11, 12, 14, 15, 13, 16, 17, 18, 19, 20, 23, 21, 22, 24, 27]
26	add list is: [0, 2, 4, 6, 3, 8, 7, 1, 9, 10, 5, 11, 12, 14, 15, 13, 16, 17, 18, 19, 20, 23, 21, 22, 24, 27, 26]
28	add list is: [0, 2, 4, 6, 3, 8, 7, 1, 9, 10, 5, 11, 12, 14, 15, 13, 16, 17, 18, 19, 20, 23, 21, 22, 24, 27, 26, 28]
25	add list is: [0, 2, 4, 6, 3, 8, 7, 1, 9, 10, 5, 11, 12, 14, 15, 13, 16, 17, 18, 19, 20, 23, 21, 22, 24, 27, 26, 28, 25]
29	add list is: [0, 2, 4, 6, 3, 8, 7, 1, 9, 10, 5, 11, 12, 14, 15, 13, 16, 17, 18, 19, 20, 23, 21, 22, 24, 27, 26, 28, 25, 29]
Exception in thread "24" java.util.ConcurrentModificationException
	at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:911)
	at java.util.ArrayList$Itr.next(ArrayList.java:861)
```